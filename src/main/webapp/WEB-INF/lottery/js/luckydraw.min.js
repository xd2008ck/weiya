function getRandom(e,l){var t=Math.random()*(l-e),a=Math.round(t+e);return a=Math.max(Math.min(a,l),e)}var beginTimer,stopTimer,luckTimer,scrollRange=190,luckState=!0,isLuck="",luckNumber,luckNumberList=1,luckLevel,showLevel,autoLuck=!1,selectNumber=1,luckScrollTime=1,stopLuckTime,luckUl=$("#luck_user ul"),deleteLuckUser="",alldataarr=[],setintIndex=0,getLottery=function(){var e=BaseUrl+"user/userList";$.ajax({async:!0,url:e,success:function(e){alldataarr=e.data}})},luckUserList=function(){luckUl.css("width",190*$("#luck_user").find("li").length*2),luckUl.append(luckUl.html())},removeUserList=function(){luckUl.find("li").each(function(e,l){$(this).index()+1>luckUl.find("li").length/2&&$(this).remove()})},isAuto=function(){setintIndex=setInterval(function(){var e=getRandom(0,alldataarr.length);$("#span_name").html(alldataarr[e].name),$("#img_user").attr("src",alldataarr[e].headImgUrl)},100),$("#showPrize").hide();var e=$("select[name='userNum']").val(),l=$("select[name='prize']").val();return e>1?(autoLuck=!0,luckNumberList=e,selectNumber=e):(autoLuck=!1,selectNumber=1,luckNumberList=1),luckLevel=l,levelMaxNum=1*$("#showLevel").find("a").attr("data-amount"),luckNumber=1*e,showLevel=l,""!=isLuck&&(luckUl.find("li[data-userid="+isLuck+"]").remove(),luckUl.width(luckUl.width()-380),isLuck=""),""!=deleteLuckUser&&(removeUserList(),luckUl.append(deleteLuckUser),luckUserList(),deleteLuckUser=""),$("#luck_user li").length<0?(showInfo("当前还没有人参加活动",0),!1):(2==$("#luck_user li").length&&($("#luck_user ul li:last").remove(),luckUl.width(190),luckUl.css("left","170px")),0==luckLevel?(showInfo("请选择抽奖等级",0),!1):($("#test").val(luckNumberList),1*luckNumberList>levelMaxNum?(showInfo("亲，奖品没那么多!",0),!1):""!=isLuck&&luckNumber>Math.max(1,$("#luck_user li").length/2-1)?(showInfo("抽奖人数不够!",0),!1):luckNumber>Math.max(1,$("#luck_user li").length/2)&&(showInfo("抽奖人数不够!",0),!1)))},beginLuck=function(){if(stopLuckTime=0,1==autoLuck&&($("#beginLuck").hide(),$("#stopLuck").hide(),$("#luckIng").show(),$("#luckIng span").text(luckNumberList),setTimeout(function(){stopLuck(luckNumberList)},2e3)),luckState){if($("#stopLuck").show(),$("#beginLuck").hide(),""!=isLuck&&(luckUl.find("li[data-userid="+isLuck+"]").remove(),luckUl.width(luckUl.width()-380)),0==$("#luck_user li").length)return showInfo("已经没有人了!",0),$("#stopLuck").hide(),$("#beginLuck").show(),!1;1==$("#luck_user li").length&&(luckUl.width(190),luckUl.css("left","170px")),2==$("#luck_user li").length&&($("#luck_user li:last").remove(),luckUl.width(190),luckUl.css("left","170px")),$("#luck_user li").length>2&&(beginTimer=setInterval(function(){luckUl.css({left:-scrollRange}),scrollRange+=60,scrollRange>luckUl.width()/2+45&&(luckUl.css("left",-20),scrollRange=190),stopLuckTime+=100,1==autoLuck&&stopLuckTime>15e4&&(clearInterval(beginTimer),console.log(luckNumberList),stopLuck(luckNumberList))},luckScrollTime))}else showInfo("抽奖进行中...")},stopLuck=function(){clearInterval(setintIndex);var e=[1,2,3],l=0;return setInterval(function(){console.log("恭喜您中奖了"+e[l]),l+=1},1e3),!1},deleteThis=function(e,l){var t=e.parent();1!=t.data("hasluck")&&(deleteLuckUser=deleteLuckUser+'<li data-userid="'+t.attr("data-isluck")+'"><img src="'+t.find("img").attr("src")+'"><br><span>'+t.find("font").html()+"</span></li>",$("[data-prizeid="+l+"]").find("label").html(1*$("[data-prizeid="+l+"]").find("label").html()+1),$("[data-prizeid="+l+"]").attr("data-amount",1*$("[data-prizeid="+l+"]").find("label").html()),_parents=$(e).parents(".level"),t.remove(),_parents.find("li").each(function(e,l){$(l).find("span").html(_parents.find("li").size()-$(l).index())}),0==_parents.find("li").length&&_parents.remove(),_parents.find("label a").text(_parents.find("li").length),$("#luckNumber").html($("#luckUl li").length))},removeLottery=function(){$("#removeLottery").hasClass("gray")||($("#removeLottery").addClass("gray"),$("#submitLottery").addClass("gray"),$("#luckUl li").each(function(e,l){if(1!=$(l).data("hasluck")){deleteLuckUser=deleteLuckUser+'<li data-userid="'+$(l).attr("data-isluck")+'"><img src="'+$(l).find("img").attr("src")+'"><br><span>'+$(l).find("font").html()+"</span></li>",$("[data-prizeid="+$(l).data("level")+"]").find("label").html(1*$("[data-prizeid="+$(l).data("level")+"]").find("label").html()+1),$("[data-prizeid="+$(l).data("level")+"]").attr("data-amount",1*$("[data-prizeid="+$(l).data("level")+"]").find("label").html());var t=$(l).parents(".level");$(l).remove(),t.find("li").each(function(e,l){$(l).find("span").html(t.find("li").size()-$(l).index())}),0==t.find("li").length&&t.remove(),t.find("label a").text(t.find("li").length),$("#luckNumber").html($("#luckUl li").length)}}),luckUserList())},showLuckAnimate=function(e,l,t){$("body").append('<div class="animate-bg"><div class="light"></div><img class="luckbg" src="images/luckbg.png" /><img src="'+e+'" class="luckUserHead" /><div class="showLuckUserName">'+t+'</div><div class="showLuckLevel">恭喜<span>'+t+"</span> 获<span>"+luckLevel+"</span>！</div></div>"),$(".luckbg").animate({width:"800px",height:"518px","margin-top":"-330px","margin-left":"-400px",opacity:"1"},"fast"),$(".luckUserHead").animate({"margin-top":"-275px"}),$(".showLuckLevel").animate({"margin-top":"40px"}),$(".showLuckUserName").animate({opacity:"1"}),setTimeout(function(){$(".animate-bg").animate({opacity:"0"},"slow",function(){$(".animate-bg").remove()}),$("#bgsound").remove()},3e3)},SubmitLotteryFans=function(e){var l=$("#luckUl li[data-hasluck!=1]").size();if(!$("#removeLottery").hasClass("gray")&&l>0){var t=$("<form/>"),a=[];$("#luckUl li[data-hasluck!=1]").each(function(e,l){var i=$(l).data("isluck");t.append('<input name="['+e+'].AwardId" type="hidden" value="'+$(l).data("level")+'" />'),t.append('<input name="['+e+'].FansId" type="hidden" value="'+i+'" />'),t.append('<input name="['+e+'].FansNickName" type="hidden" value="'+$(l).find("font").text()+'" />'),t.append('<input name="['+e+'].FansHead" type="hidden" value="'+$(l).data("headpath")+'" />'),a.push(i)}),a=JSON.stringify(a);var i=BaseUrl+"user/submitLottery";$.ajax({type:"POST",url:i,contentType:"application/json",data:a,success:function(e){loaded("正在提交，请稍后..."),"成功"==e.message?(showInfo("提交成功！",1),$("#removeLottery").addClass("gray"),$("#submitLottery").addClass("gray"),$("#luckUl li[data-hasluck!=1]").attr("data-hasluck",1).append('<i class="hasSubmit">已提交</i>').find("a").remove()):showInfo("提交失败！",0)}}),getLottery()}},stopBubble=function(){var e="undefined"==typeof event?arguments.callee.caller.arguments[0]:event;e&&e.stopPropagation?e.stopPropagation():window.event.cancelBubble=!0};