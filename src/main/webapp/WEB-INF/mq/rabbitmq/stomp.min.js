(function(){var t,n,e,i,o={}.hasOwnProperty;t={LF:"\n",NULL:"\0"},e=function(){function n(t,n,e){this.command=t,this.headers=null!=n?n:{},this.body=null!=e?e:""}return n.prototype.toString=function(){var n,e,i,r;n=[this.command],r=this.headers;for(e in r)o.call(r,e)&&(i=r[e],n.push(""+e+":"+i));return this.body&&n.push("content-length:"+(""+this.body).length),n.push(t.LF+this.body),n.join(t.LF)},n._unmarshallSingle=function(e){var i,o,r,s,u,a,c,d,h,f,p,l,g,b,y,w;for(s=e.search(RegExp(""+t.LF+t.LF)),u=e.substring(0,s).split(t.LF),r=u.shift(),a={},l=function(t){return t.replace(/^\s+|\s+$/g,"")},f=d=null,c=g=0,y=u.length;0<=y?g<y:g>y;c=0<=y?++g:--g)f=u[c],d=f.indexOf(":"),a[l(f.substring(0,d))]=l(f.substring(d+1));if(i="",p=s+2,a["content-length"])h=parseInt(a["content-length"]),i=(""+e).substring(p,p+h);else for(o=null,c=b=p,w=e.length;(p<=w?b<w:b>w)&&(o=e.charAt(c),o!==t.NULL);c=p<=w?++b:--b)i+=o;return new n(r,a,i)},n.unmarshall=function(e){var i;return function(){var o,r,s,u;for(s=e.split(RegExp(""+t.NULL+t.LF+"*")),u=[],o=0,r=s.length;o<r;o++)i=s[o],(null!=i?i.length:void 0)>0&&u.push(n._unmarshallSingle(i));return u}()},n.marshall=function(e,i,o){var r;return r=new n(e,i,o),r.toString()+t.NULL},n}(),n=function(){function n(t){this.ws=t,this.ws.binaryType="arraybuffer",this.counter=0,this.connected=!1,this.heartbeat={outgoing:1e4,incoming:1e4},this.maxWebSocketFrameSize=16384,this.subscriptions={}}return n.prototype.debug=function(t){var n;return"undefined"!=typeof window&&null!==window&&null!=(n=window.console)?n.log(t):void 0},n.prototype._transmit=function(t,n,i){var o;for(o=e.marshall(t,n,i),"function"==typeof this.debug&&this.debug(">>> "+o);;){if(!(o.length>this.maxWebSocketFrameSize))return this.ws.send(o);this.ws.send(o.substring(0,this.maxWebSocketFrameSize)),o=o.substring(this.maxWebSocketFrameSize),"function"==typeof this.debug&&this.debug("remaining = "+o.length)}},n.prototype._setupHeartbeat=function(n){var e,o,r,s,u,a,c=this;if((u=n.version)===i.VERSIONS.V1_1||u===i.VERSIONS.V1_2)return a=function(){var t,e,i,o;for(i=n["heart-beat"].split(","),o=[],t=0,e=i.length;t<e;t++)s=i[t],o.push(parseInt(s));return o}(),o=a[0],e=a[1],0!==this.heartbeat.outgoing&&0!==e&&(r=Math.max(this.heartbeat.outgoing,e),"function"==typeof this.debug&&this.debug("send PING every "+r+"ms"),this.pinger="undefined"!=typeof window&&null!==window?window.setInterval(function(){return c.ws.send(t.LF),"function"==typeof c.debug?c.debug(">>> PING"):void 0},r):void 0),0!==this.heartbeat.incoming&&0!==o?(r=Math.max(this.heartbeat.incoming,o),"function"==typeof this.debug&&this.debug("check PONG every "+r+"ms"),this.ponger="undefined"!=typeof window&&null!==window?window.setInterval(function(){var t;if(t=Date.now()-c.serverActivity,t>2*r)return"function"==typeof c.debug&&c.debug("did not receive server activity for the last "+t+"ms"),c.ws.close()},r):void 0):void 0},n.prototype.connect=function(n,o,r,s,u){var a=this;return this.connectCallback=r,"function"==typeof this.debug&&this.debug("Opening Web Socket..."),this.ws.onmessage=function(n){var i,o,r,u,c,d,h,f,p;if(r="undefined"!=typeof ArrayBuffer&&n.data instanceof ArrayBuffer?(i=new Uint8Array(n.data),"function"==typeof a.debug?a.debug("--- got data length: "+i.length):void 0,function(){var t,n,e;for(e=[],t=0,n=i.length;t<n;t++)o=i[t],e.push(String.fromCharCode(o));return e}().join("")):n.data,a.serverActivity=Date.now(),r===t.LF)return void("function"==typeof a.debug&&a.debug("<<< PONG"));for("function"==typeof a.debug&&a.debug("<<< "+r),f=e.unmarshall(r),p=[],d=0,h=f.length;d<h;d++)switch(u=f[d],u.command){case"CONNECTED":"function"==typeof a.debug&&a.debug("connected to server "+u.headers.server),a.connected=!0,a._setupHeartbeat(u.headers),p.push("function"==typeof a.connectCallback?a.connectCallback(u):void 0);break;case"MESSAGE":c=a.subscriptions[u.headers.subscription]||a.onreceive,c?p.push(c(u)):p.push("function"==typeof a.debug?a.debug("Unhandled received MESSAGE: "+u):void 0);break;case"RECEIPT":p.push("function"==typeof a.onreceipt?a.onreceipt(u):void 0);break;case"ERROR":p.push("function"==typeof s?s(u):void 0);break;default:p.push("function"==typeof a.debug?a.debug("Unhandled frame: "+u):void 0)}return p},this.ws.onclose=function(){var t;return t="Whoops! Lost connection to "+a.ws.url,"function"==typeof a.debug&&a.debug(t),a._cleanUp(),"function"==typeof s?s(t):void 0},this.ws.onopen=function(){var t;return"function"==typeof a.debug&&a.debug("Web Socket Opened..."),t={"accept-version":i.VERSIONS.supportedVersions(),"heart-beat":[a.heartbeat.outgoing,a.heartbeat.incoming].join(",")},u&&(t.host=u),n&&(t.login=n),o&&(t.passcode=o),a._transmit("CONNECT",t)}},n.prototype.disconnect=function(t){return this._transmit("DISCONNECT"),this.ws.onclose=null,this.ws.close(),this._cleanUp(),"function"==typeof t?t():void 0},n.prototype._cleanUp=function(){if(this.connected=!1,this.pinger&&"undefined"!=typeof window&&null!==window&&window.clearInterval(this.pinger),this.ponger)return"undefined"!=typeof window&&null!==window?window.clearInterval(this.ponger):void 0},n.prototype.send=function(t,n,e){return null==n&&(n={}),null==e&&(e=""),n.destination=t,this._transmit("SEND",n,e)},n.prototype.subscribe=function(t,n,e){return null==e&&(e={}),e.id||(e.id="sub-"+this.counter++),e.destination=t,this.subscriptions[e.id]=n,this._transmit("SUBSCRIBE",e),e.id},n.prototype.unsubscribe=function(t){return delete this.subscriptions[t],this._transmit("UNSUBSCRIBE",{id:t})},n.prototype.begin=function(t){return this._transmit("BEGIN",{transaction:t})},n.prototype.commit=function(t){return this._transmit("COMMIT",{transaction:t})},n.prototype.abort=function(t){return this._transmit("ABORT",{transaction:t})},n.prototype.ack=function(t,n,e){return null==e&&(e={}),e["message-id"]=t,e.subscription=n,this._transmit("ACK",e)},n.prototype.nack=function(t,n,e){return null==e&&(e={}),e["message-id"]=t,e.subscription=n,this._transmit("NACK",e)},n}(),i={libVersion:"2.0.0-next",VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(t,e){var o,r;return null==e&&(e=["v10.stomp","v11.stomp"]),o=i.WebSocketClass||WebSocket,r=new o(t,e),new n(r)},over:function(t){return new n(t)},Frame:e},"undefined"!=typeof window&&null!==window?window.Stomp=i:"undefined"!=typeof exports&&null!==exports?(exports.Stomp=i,i.WebSocketClass=require("./test/server.mock.js").StompServerMock):self.Stomp=i}).call(this);